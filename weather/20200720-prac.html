<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>
    <link rel="stylesheet" href="css/css.css">
    <link rel="stylesheet" href="css/weather-icons.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div id="weather_info">
        <h1 class="city"></h1>
        <!-- <i class="icon wi"></i> -->
        <section>
            <div class="icon_box">
                <figure class="icon"></figure>
                <p class="w_id"></p>
            </div>
            <div class="body_center">
                <p class="temp"></p>
            </div>
            <aside class="body_right">
                <p class="temp_max">max</p>
                <p class="temp_min">min</p>
            </aside>
        </section>
        <img src="img/loading.svg" alt="" class="load_img" width="50">
        <!-- <img class="load_img" src="loading.gif" width="50"> -->

    </div>

    <script>

        // API 요청
        var url = 'http://api.openweathermap.org/data/2.5/weather?q=seoul&appid=670bf5d30cda72bc335154412e500db7';



        // 로딩 이미지 표시
        $('weather_info .load_img').show();

        $.getJSON(url,function(data){
            var sys = data.sys;             // 국가명, 일출 일몰
            var city = data.name;           // 도시명
            var weather = data.weather;     // 날씨 객체
            var main = data.main;           // 온도 기압 관련 객체
            var wmain = weather[0].main;    // 구름 상태
            var w_id = weather[0].id;       // 날씨상태 id 코드
            var icon = weather[0].icon;     // 날씨 아이콘 정보
            var country = sys.country;      // 국가명
            var temp = main.temp;           // 현재 온도
            var temp_min = main.temp_min;   // 최저 온도
            var temp_max = main.temp_max;   // 최고 온도
            var wind = data.wind;           // 바람

            // 날씨 아이콘 표시
            // var icon_url = 'http://openweathermap.org/img/wn/' + icon;
            // weather icon_url
            var nowTimestamp = Math.floor(Date.now() / 1000);
            var weatherClass = 'wi wi-owm-';
            weatherClass += (nowTimestamp >= data.sunrise && nowTimestamp <= data.sunset ? 'day' : 'night');
            weatherClass += ('-' + weather[0].id);

            $("#weather_info .icon").addClass(weatherClass);


            // 날씨 정보 표시
            $('#weather_info > .city').html(city + "/" + country);
            // $('#weather_info .icon').html("<img src='" + icon_url + ".png'>");
            $('#weather_info .w_id').html(wmain);
            $('#weather_info .temp_min').html(parseInt(temp_min-273.15) + '&deg;' + ' min');
            $('#weather_info .temp_max').html(parseInt(temp_max-273.15) + '&deg;' + ' max');
            $('#weather_info .temp').html(parseInt(temp-273.15) + '&deg;');




            // 데이터 로딩 후 로딩이미지 제거
            $('#weather_info .load_img').hide();
        })

        // // end getJSON
        .fail(function(){
            // 오류 메시지
            alert("loading error");
        });

    </script>
</body>
</html>